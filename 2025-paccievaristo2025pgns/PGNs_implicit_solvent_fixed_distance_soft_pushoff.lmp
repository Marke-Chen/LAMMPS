# Application of Soft Pushoff Potentials to Pair of PGNs at Fixed Distance in Implicit Solvent

# Overview
# This LAMMPS input file sets up a LAMMPS simulation that applies linearly hardening soft pushoff potentials to the potentially unphysical input system generated by make_data_PGNs_implicit_solvent_fixed_distance.py and described in PGNs_implicit_solvent_fixed_distance.dat. The input system is potentially unphysical for possibly containing particle overlaps. The initial velocities of all particles are zero. The forces acting on the centers of mass of the monomer-grafted nanoparticles are calculated every timestep but not applied to them. Such constraints enforce that the positions of the centers of mass of the monomer-grafted nanoparticles do not vary through time. All values in this input file are provided and generated in the LAMMPS LJ unit system.
# The particles in PGNs_implicit_solvent_fixed_distance.dat are identified in LAMMPS as:
# * Grafted Monomers: type 1
# * Non-Grafted Monomers: type 2
# * Nanoparticles: type 3

# Physics Setup
units           lj
atom_style      molecular

# System Setup
read_data       PGNs_implicit_solvent_fixed_distance.dat
# Input file PGNs_implicit_solvent_fixed_distance.dat generated by the Python 3 script make_data_PGNs_implicit_solvent_fixed_distance.py.

${atom_id_group_statement_mgn1}
${atom_id_group_statement_mgn2}
# Variables above expanded by the Python 3 script make_data_PGNs_implicit_solvent_fixed_distance.py.
group           mgns union mgn1 mgn2
# Line above to reflect the number of monomer-grafted nanoparticles in the system.
${atom_id_group_statement_pgn1}
${atom_id_group_statement_pgn2}
# Variables above expanded by the Python 3 script make_data_PGNs_implicit_solvent_fixed_distance.py.
group           pgns union pgn1 pgn2
# Line above to reflect the number of polymer-grafted nanoparticles in the system.
${atom_id_group_statement_np1}
${atom_id_group_statement_np2}
# Variables above expanded by the Python 3 script make_data_PGNs_implicit_solvent_fixed_distance.py.
group           nps union np1 np2
# Line above to reflect the number of nanoparticles in the system.
${atom_id_group_statement_selgraftmon1}
${atom_id_group_statement_selgraftmon2}
# Variables above expanded by the Python 3 script make_data_PGNs_implicit_solvent_fixed_distance.py.
# Each selected grafted monomer to be the first grafted monomer attached to each nanoparticle in the system.
group           selgraftmons union selgraftmon1 selgraftmon2
# Line above to reflect the number of selected grafted monomers in the system.
group           nongraftmons type 2
# Non-grafted monomers set to particle type 2.
group           allmons type 1 2
# Monomers set to particle type 1 if grafted and to particle type 2 if non-grafted.
compute         chunkatomall all chunk/atom molecule
# Particles are grouped in chunks according to molecule-ID.

bond_style      fene
bond_coeff      1 30. 1.5 1. 1.
special_bonds   fene
# Monomers belonging to the same grafted chain bonded by finitely extensible nonlinear elastic bonds.

variable        radius_nanoparticles file radius_nanoparticles.txt
# The value of radius_nanoparticles is specified in and obtained from radius_nanoparticles.txt.
if "${radius_nanoparticles} == 2.500000" then "variable        skin equal 1.9"
if "${radius_nanoparticles} == 5.000000" then "variable        skin equal 1.3"
if "${radius_nanoparticles} == 7.500000" then "variable        skin equal 1.1"
if "${radius_nanoparticles} == 10.000000" then "variable        skin equal 0.8"
neighbor        ${skin} multi
# Use of multi binning algorithm made necessary by the difference in size between nanoparticles and monomers.
if "${radius_nanoparticles} == 2.500000" then "variable        one equal 1000"
if "${radius_nanoparticles} == 5.000000" then "variable        one equal 2000"
if "${radius_nanoparticles} == 7.500000" then "variable        one equal 3950"
if "${radius_nanoparticles} == 10.000000" then "variable        one equal 4300"
variable        page equal 10*${one}
neigh_modify    every 1 delay 0 check yes page ${page} one ${one}
# Tuning of the memory allocated to neighbor lists made necessary by the large number of particles in the system. The values of "page" and "one" are set according to the maximum total number of particles in the system for the given radius of the nanoparticles.
neigh_modify    exclude molecule/inter mgn1
neigh_modify    exclude molecule/inter mgn2
# Interactions between particles belonging to the same monomer-grafted nanoparticle are turned off because monomer-grafted nanoparticles are constructed as rigid bodies. Computational optimization ensues.
comm_modify     mode multi

velocity        all set 0. 0. 0.
# Initial velocities of all particles set to zero as precaution.

# Simulation Setup
timestep        .005
# Timestep in tau.
variable        dumping_interval_timesteps equal 1000
# Interval between every two data dumps in timesteps.
variable        end_timesteps_soft_pushoff file time.txt
# End of the Soft Pushoff run in timesteps.
variable        step equal step
# Time in timesteps. Creation of variable counterpart to thermo keyword "step."
variable        time equal time
# Time in tau. Creation of variable counterpart to thermo keyword "time."

thermo          ${dumping_interval_timesteps}
thermo_style    custom step time temp press vol ke pe ebond evdwl lx ly lz
# vol, lx, ly, and lz not to vary and only printed as extra control tool.

# Soft Pushoff
pair_style      hybrid soft 1. lj/cut 1.122462 lj/expand 1.122462
pair_modify     shift yes
pair_coeff      1 1 lj/cut 1. 1.
pair_coeff      1 2 soft .1
pair_coeff      1 3 lj/expand 1. 1. ${radius_nps}
pair_coeff      2 2 soft .1
pair_coeff      2 3 lj/expand 1. 1. ${radius_nps}
pair_coeff      3 3 lj/expand 1. 1. ${diameter_nps}

variable        prefactor equal ramp(.1,30.)
fix             adaptall1 all adapt 1 pair soft a 1 2 v_prefactor
fix             adaptall2 all adapt 1 pair soft a 2 2 v_prefactor
# Soft pushoff potentials are hardened over time to rid the system of potential particle overlaps without breaking its grafted chains apart by drastically separating their bonded monomers at any given timestep.
fix             nvtnongraftmons nongraftmons nvt temp 1. 1. 1.
# NVT time integration of the equations of motion for the non-grafted monomers.
fix             rigidnvtmgns mgns rigid/nvt group 2 mgn1 mgn2 temp 1. 1. 1. force * off off off
# NVT time integration of the equations of motion for the monomer-grafted nanoparticles constructed as rigid bodies.
variable        f_rigidnvtmgns_1_1 equal f_rigidnvtmgns[1][1]
variable        f_rigidnvtmgns_1_2 equal f_rigidnvtmgns[1][2]
variable        f_rigidnvtmgns_1_3 equal f_rigidnvtmgns[1][3]
variable        f_rigidnvtmgns_2_1 equal f_rigidnvtmgns[2][1]
variable        f_rigidnvtmgns_2_2 equal f_rigidnvtmgns[2][2]
variable        f_rigidnvtmgns_2_3 equal f_rigidnvtmgns[2][3]
fix             printmgn1 mgn1 print ${dumping_interval_timesteps} "${step} ${time} ${f_rigidnvtmgns_1_1} ${f_rigidnvtmgns_1_2} ${f_rigidnvtmgns_1_3}" file position_soft_pushoff_mgn1.txt screen no
fix             printmgn2 mgn2 print ${dumping_interval_timesteps} "${step} ${time} ${f_rigidnvtmgns_2_1} ${f_rigidnvtmgns_2_2} ${f_rigidnvtmgns_2_3}" file position_soft_pushoff_mgn2.txt screen no
# Printing of the components of the positions of the centers of mass of the monomer-grafted nanoparticles through time.
variable        position_np1_x equal xcm(np1,x)
variable        position_np1_y equal xcm(np1,y)
variable        position_np1_z equal xcm(np1,z)
variable        position_np2_x equal xcm(np2,x)
variable        position_np2_y equal xcm(np2,y)
variable        position_np2_z equal xcm(np2,z)
fix             printnp1 np1 print ${dumping_interval_timesteps} "${step} ${time} ${position_np1_x} ${position_np1_y} ${position_np1_z}" file position_soft_pushoff_np1.txt screen no
fix             printnp2 np2 print ${dumping_interval_timesteps} "${step} ${time} ${position_np2_x} ${position_np2_y} ${position_np2_z}" file position_soft_pushoff_np2.txt screen no
# Printing of the components of the positions of the nanoparticles through time.
variable        position_selgraftmon1_x equal xcm(selgraftmon1,x)
variable        position_selgraftmon1_y equal xcm(selgraftmon1,y)
variable        position_selgraftmon1_z equal xcm(selgraftmon1,z)
variable        position_selgraftmon2_x equal xcm(selgraftmon2,x)
variable        position_selgraftmon2_y equal xcm(selgraftmon2,y)
variable        position_selgraftmon2_z equal xcm(selgraftmon2,z)
fix             printselgraftmon1 selgraftmon1 print ${dumping_interval_timesteps} "${step} ${time} ${position_selgraftmon1_x} ${position_selgraftmon1_y} ${position_selgraftmon1_z}" file position_soft_pushoff_selgraftmon1.txt screen no
fix             printselgraftmon2 selgraftmon2 print ${dumping_interval_timesteps} "${step} ${time} ${position_selgraftmon2_x} ${position_selgraftmon2_y} ${position_selgraftmon2_z}" file position_soft_pushoff_selgraftmon2.txt screen no
# Printing of the components of the positions of the selected grafted monomers through time.
compute         gyrationchunkall all gyration/chunk chunkatomall
fix             avetimeall all ave/time 1 ${dumping_interval_timesteps} ${dumping_interval_timesteps} c_gyrationchunkall file average_radii_of_gyration_soft_pushoff.txt mode vector
# Calculation and printing of time block averages of the radii of gyration of all molecules in the system through time.
variable        f_rigidnvtmgns_1_7 equal f_rigidnvtmgns[1][7]
variable        f_rigidnvtmgns_1_8 equal f_rigidnvtmgns[1][8]
variable        f_rigidnvtmgns_1_9 equal f_rigidnvtmgns[1][9]
variable        f_rigidnvtmgns_2_7 equal f_rigidnvtmgns[2][7]
variable        f_rigidnvtmgns_2_8 equal f_rigidnvtmgns[2][8]
variable        f_rigidnvtmgns_2_9 equal f_rigidnvtmgns[2][9]
fix             avetimemgn1 mgn1 ave/time 1 ${dumping_interval_timesteps} ${dumping_interval_timesteps} v_time v_f_rigidnvtmgns_1_7 v_f_rigidnvtmgns_1_8 v_f_rigidnvtmgns_1_9 file average_force_soft_pushoff_mgn1.txt mode scalar off 1
fix             avetimemgn2 mgn2 ave/time 1 ${dumping_interval_timesteps} ${dumping_interval_timesteps} v_time v_f_rigidnvtmgns_2_7 v_f_rigidnvtmgns_2_8 v_f_rigidnvtmgns_2_9 file average_force_soft_pushoff_mgn2.txt mode scalar off 1
# Calculation and printing of time block averages of the components of the forces acting on the centers of mass of the monomer-grafted nanoparticles through time.
compute         reducepgn1 pgn1 reduce sum fx fy fz
compute         reducepgn2 pgn2 reduce sum fx fy fz
fix             avetimepgn1 pgn1 ave/time 1 ${dumping_interval_timesteps} ${dumping_interval_timesteps} v_time c_reducepgn1[1] c_reducepgn1[2] c_reducepgn1[3] file average_force_soft_pushoff_pgn1.txt mode scalar off 1
fix             avetimepgn2 pgn2 ave/time 1 ${dumping_interval_timesteps} ${dumping_interval_timesteps} v_time c_reducepgn2[1] c_reducepgn2[2] c_reducepgn2[3] file average_force_soft_pushoff_pgn2.txt mode scalar off 1
# Calculation and printing of time block averages of the components of the forces acting on the centers of mass of the polymer-grafted nanoparticles through time.

dump            customallsoftpushoff all custom ${dumping_interval_timesteps} PGNs_implicit_solvent_fixed_distance_soft_pushoff.lammpstrj id mol type xs ys zs ix iy iz
# Printing of trajectory file frames in frequency to match that of PGNs_implicit_solvent_fixed_distance_equilibration_nvt.lmp.
restart         ${end_timesteps_soft_pushoff} PGNs_implicit_solvent_fixed_distance_soft_pushoff.restart
# Printing of restart file.
run             ${end_timesteps_soft_pushoff}
